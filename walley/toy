#!/usr/bin/env python
from toy import *
import sys
print sys.argv

# toy language simple repl
def repl(prompt="toy > "):
    while True:
        input_str = raw_input(prompt)
        print toy(parser(lexer(input_str)[0]),global_env)
        #print global_env

# COMMANDS
# fix /t problem
def cleanString(input_str):
    count_of_double_quote = 0
    output = ""
    i=0
    while i<len(input_str):
        if input_str[i]=="\"":
            count_of_double_quote = count_of_double_quote + 1
        if count_of_double_quote%2==0 and (input_str[i]=="\t"):
            output = output+ " "
            i=i+1
            continue
        output = output+input_str[i]
        i=i+1
    return output
# run one file
if len(sys.argv)==2:
    file_name=sys.argv[1]
    file=open(file_name)
    string_in_side = file.read()
    string_in_side = cleanString(string_in_side)
    #print "\n\nLexer---->\n"
    #print "--> "+string_in_side
    x=lexer(string_in_side)
    #print x
    if x[1]==False:
        print "Incomplete Statement"
        exit(0)
    x=parser(x[0])

    #print "\n\nParser---->\n"
    #print x
    #print "Parser----> ",
    #print x
    toy(x,global_env)

# compress file
elif len(sys.argv)==3 and sys.argv[1]=="compress":
    file_name=sys.argv[2]
    file=open(file_name)
    string_in_side = file.read()
    string_in_side = cleanString(string_in_side)

    x = lexer(string_in_side)[0]
    if x[1]==False:
        print "Incomplete Statement\nCannot compress file "+file_name
        exit(0)
    i=0
    output = ""
    length = len(x)
    while i<length:
        if x[i]=="(":
            output = output+"("
            i=i+1
            continue
        else:
            # deal with string problem
            if x[i][0]=="\"":
                x[i]="\\"+x[i]
                x[i]=x[i][0:len(x[i])-1]
                x[i]=x[i]+"\\\""
            output=output+x[i]
            if i+1!=length and x[i+1]==")":
                i=i+1
            else:
                output=output+" "
                i=i+1
    print "====================\n\n\n"
    print output


elif len(sys.argv)==1:
    print "Toy Language >>>>>>>>>>>>>>>"
    print "Press ctrl+C to quit\n"
    repl()
else:
    print "Argv Error.."


